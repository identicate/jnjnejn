#!/bin/bash



send_to_teams() {
  local message=$1
  local status=$2
  local color=""

  if [[ "$status" == "UP" ]]; then
    color="00FF00"  # Green for UP
  else
    color="FF0000"  # Red for DOWN
  fi

  curl -H "Content-Type: application/json" -d "{
    \"@type\": \"MessageCard\",
    \"@context\": \"http://schema.org/extensions\",
    \"themeColor\": \"$color\",
    \"summary\": \"Application Status Notification\",
    \"sections\": [{
      \"activityTitle\": \"$message\",
      \"facts\": [{
        \"name\": \"Status:\",
        \"value\": \"$status\"
      }],
      \"markdown\": true
    }]
  }" "$TEAMS_WEBHOOK_URL"
}

check_app_status() {
  local url=$1

  response=$(curl -s -o /dev/null -w "%{http_code}" --max-time 5 "$url")

  if [[ "$response" -eq 200 ]]; then
    local message="Status: UP - $url is reachable."
    echo "$message"
    send_to_teams "$message" "UP"
  else
    local message="Status: DOWN - $url returned HTTP code $response."
    echo "$message"
    send_to_teams "$message" "DOWN"
  fi
}

echo "Checking application status for $APP_URL..."
check_app_status "$APP_URL"
